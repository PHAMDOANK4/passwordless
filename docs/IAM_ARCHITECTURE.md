# IAM Platform Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     IAM Platform                                 â”‚
â”‚         (Identity & Access Management System)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Domain A          â”‚          â”‚   Domain B          â”‚
â”‚   company-a.com     â”‚          â”‚   company-b.vn      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Owner: admin@...    â”‚          â”‚ Owner: admin@...    â”‚
â”‚ MFA Required: Yes   â”‚          â”‚ MFA Required: No    â”‚
â”‚ Max Users: 1000     â”‚          â”‚ Max Users: 500      â”‚
â”‚                     â”‚          â”‚                     â”‚
â”‚ Users:              â”‚          â”‚ Users:              â”‚
â”‚ â”œâ”€ john@...         â”‚          â”‚ â”œâ”€ nguyen@...       â”‚
â”‚ â”œâ”€ jane@...         â”‚          â”‚ â”œâ”€ tran@...         â”‚
â”‚ â””â”€ bob@...          â”‚          â”‚ â””â”€ le@...           â”‚
â”‚                     â”‚          â”‚                     â”‚
â”‚ Auth Methods:       â”‚          â”‚ Auth Methods:       â”‚
â”‚ â”œâ”€ WebAuthn âœ“       â”‚          â”‚ â”œâ”€ WebAuthn âœ“       â”‚
â”‚ â”œâ”€ TOTP âœ“           â”‚          â”‚ â”œâ”€ TOTP âœ“           â”‚
â”‚ â”œâ”€ Email OTP âœ“      â”‚          â”‚ â”œâ”€ Email OTP âœ“      â”‚
â”‚ â””â”€ SMS OTP âœ“        â”‚          â”‚ â””â”€ SMS OTP âœ“        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Entity Relationship

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Domain      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ id (PK)       â”‚
â”‚ â€¢ domainName    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ displayName   â”‚         â”‚
â”‚ â€¢ ownerEmail    â”‚         â”‚
â”‚ â€¢ requireMFA    â”‚         â”‚ 1
â”‚ â€¢ ssoEnabled    â”‚         â”‚
â”‚ â€¢ maxUsers      â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
                            â”‚
                            â”‚ Many
                            â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚      User       â”‚         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”‚
â”‚ â€¢ id (PK)       â”‚         â”‚
â”‚ â€¢ email         â”‚         â”‚
â”‚ â€¢ domain_id (FK)â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â€¢ firstName     â”‚
â”‚ â€¢ lastName      â”‚
â”‚ â€¢ status        â”‚
â”‚ â€¢ role          â”‚
â”‚ â€¢ mfaEnabled    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚ 1
        â”‚
        â”‚ Many
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Authenticator  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ id (PK)       â”‚
â”‚ â€¢ user_id (FK)  â”‚
â”‚ â€¢ credentialId  â”‚
â”‚ â€¢ type          â”‚
â”‚ â€¢ counter       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Authentication Flow

```
1. User Login Request
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Enter Email      â”‚
   â”‚ john@company.com â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Identify Domain  â”‚
   â”‚ â†’ company.com    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Check Domain     â”‚
   â”‚ MFA Policy       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Present Auth     â”‚
   â”‚ Options          â”‚
   â”‚ â€¢ WebAuthn       â”‚
   â”‚ â€¢ TOTP           â”‚
   â”‚ â€¢ OTP            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ User Chooses     â”‚
   â”‚ & Authenticates  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
            â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Create Session   â”‚
   â”‚ with Domain      â”‚
   â”‚ Context          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## API Structure

```
/iam/v1/
â”œâ”€â”€ domains/
â”‚   â”œâ”€â”€ POST   /                    # Create domain
â”‚   â”œâ”€â”€ GET    /                    # List domains
â”‚   â”œâ”€â”€ GET    /{domainId}          # Get domain
â”‚   â”œâ”€â”€ PATCH  /{domainId}          # Update domain
â”‚   â”œâ”€â”€ DELETE /{domainId}          # Delete domain
â”‚   â”‚
â”‚   â””â”€â”€ users/
â”‚       â”œâ”€â”€ POST   /{domainId}/users           # Create user
â”‚       â”œâ”€â”€ GET    /{domainId}/users           # List users
â”‚       â”œâ”€â”€ GET    /{domainId}/users/{userId}  # Get user
â”‚       â”œâ”€â”€ PATCH  /{domainId}/users/{userId}  # Update user
â”‚       â””â”€â”€ DELETE /{domainId}/users/{userId}  # Delete user
â”‚
â””â”€â”€ auth/
    â”œâ”€â”€ POST /login                 # Authenticate user
    â”œâ”€â”€ POST /logout                # End session
    â”œâ”€â”€ GET  /session               # Check session
    â””â”€â”€ POST /refresh               # Refresh token
```

## Multi-Tenancy Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Database Structure                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  domains                                           â”‚
â”‚  â”œâ”€ domain_1 (company-a.com)                       â”‚
â”‚  â”‚  â””â”€ users                                       â”‚
â”‚  â”‚     â”œâ”€ user_1 (john@company-a.com)             â”‚
â”‚  â”‚     â”œâ”€ user_2 (jane@company-a.com)             â”‚
â”‚  â”‚     â””â”€ user_3 (bob@company-a.com)              â”‚
â”‚  â”‚                                                  â”‚
â”‚  â”œâ”€ domain_2 (company-b.vn)                        â”‚
â”‚  â”‚  â””â”€ users                                       â”‚
â”‚  â”‚     â”œâ”€ user_4 (nguyen@company-b.vn)            â”‚
â”‚  â”‚     â””â”€ user_5 (tran@company-b.vn)              â”‚
â”‚  â”‚                                                  â”‚
â”‚  â””â”€ domain_3 (organization-c.com)                  â”‚
â”‚     â””â”€ users                                       â”‚
â”‚        â”œâ”€ user_6 (admin@organization-c.com)       â”‚
â”‚        â””â”€ user_7 (staff@organization-c.com)       â”‚
â”‚                                                     â”‚
â”‚  Complete Isolation Between Domains                â”‚
â”‚  - No data sharing                                 â”‚
â”‚  - Independent policies                            â”‚
â”‚  - Separate administration                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Features

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Security Layers              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚  1. Domain Level                    â”‚
â”‚     â€¢ Domain isolation              â”‚
â”‚     â€¢ MFA enforcement policy        â”‚
â”‚     â€¢ User quota limits             â”‚
â”‚     â€¢ SSO configuration             â”‚
â”‚                                     â”‚
â”‚  2. User Level                      â”‚
â”‚     â€¢ Account status management     â”‚
â”‚     â€¢ Login attempt tracking        â”‚
â”‚     â€¢ Account locking               â”‚
â”‚     â€¢ IP tracking                   â”‚
â”‚                                     â”‚
â”‚  3. Authentication Level            â”‚
â”‚     â€¢ Multi-factor auth             â”‚
â”‚     â€¢ WebAuthn (FIDO2)             â”‚
â”‚     â€¢ TOTP (Time-based)             â”‚
â”‚     â€¢ OTP (SMS/Email)               â”‚
â”‚                                     â”‚
â”‚  4. Session Level                   â”‚
â”‚     â€¢ Secure session tokens         â”‚
â”‚     â€¢ Domain-scoped sessions        â”‚
â”‚     â€¢ Timeout policies              â”‚
â”‚     â€¢ Audit logging                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Comparison with Enterprise IAM

| Feature | This System | Google Workspace | Azure AD |
|---------|------------|------------------|----------|
| Domain Management | âœ… | âœ… | âœ… |
| User Management | âœ… | âœ… | âœ… |
| MFA Support | âœ… | âœ… | âœ… |
| WebAuthn/FIDO2 | âœ… | âœ… | âœ… |
| TOTP | âœ… | âœ… | âœ… |
| SMS/Email OTP | âœ… | âœ… | âœ… |
| Domain-wide Policies | âœ… | âœ… | âœ… |
| Role-based Access | âœ… | âœ… | âœ… |
| SSO Support | ğŸš§ Planned | âœ… | âœ… |
| SAML Integration | ğŸš§ Planned | âœ… | âœ… |
| OAuth/OIDC | ğŸš§ Planned | âœ… | âœ… |
| Audit Logging | âœ… | âœ… | âœ… |

Legend: âœ… Implemented | ğŸš§ Planned | âŒ Not available

## Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Load Balancer / Reverse Proxy       â”‚
â”‚              (Nginx / HAProxy)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                         â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚  IAM App   â”‚          â”‚  IAM App    â”‚
â”‚ Instance 1 â”‚          â”‚ Instance 2  â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                        â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚   MySQL Database   â”‚
     â”‚  (Domains & Users) â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Next Steps

1. **Phase 2**: Implement Domain & User Management APIs
2. **Phase 3**: Add SSO/SAML/OAuth support
3. **Phase 4**: Implement RBAC system
4. **Phase 5**: Add compliance and security features

For detailed information, see:
- English: `IAM_TRANSFORMATION.md`
- Vietnamese: `IAM_TRANSFORMATION_VI.md`
